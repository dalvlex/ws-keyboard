<!DOCTYPE html>

<meta charset="utf-8" />
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
<meta name="mobile-web-app-capable" content="yes">

<title>WebSocket Keyboard</title>

<script language="javascript" type="text/javascript">


  function init()
  {
	document.myform.url.value = "wss://192.168.0.100:9502/"
	document.myform.inputtext.value = ""
	document.myform.disconnectButton.disabled = true;
  }

  function doConnect()
  {
    websocket = new WebSocket(document.myform.url.value);
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
  }

  function onOpen(evt)
  {
    writeToScreen("connected\n");
	document.myform.connectButton.disabled = true;
	document.myform.disconnectButton.disabled = false;
  }

  function onClose(evt)
  {
    writeToScreen("disconnected\n");
	document.myform.connectButton.disabled = false;
	document.myform.disconnectButton.disabled = true;
  }

  function onMessage(evt)
  {
    writeToScreen("response: " + evt.data + '\n');
  }

  function onError(evt)
  {
    writeToScreen('error: ' + evt.data + '\n');

	websocket.close();

	document.myform.connectButton.disabled = false;
	document.myform.disconnectButton.disabled = true;

  }

  function doSend(message)
  {
    websocket.send(message);
    writeToScreen("sent: " + message + '\n'); 
  }

  function writeToScreen(message)
  {
    document.myform.outputtext.value += message
	document.myform.outputtext.scrollTop = document.myform.outputtext.scrollHeight;

  }

  window.addEventListener("load", init, false);
document.onreadystatechange = () => {
  if (document.readyState === 'interactive') {
    // document ready
	document.myform.inputtext.focus();
	document.myform.inputtext.click();
  }
};

  function sendAndClear() {
let kspecial = {
8: "KEY_BACKSPACE",
9: "KEY_TAB",
13: "KEY_ENTER",
27: "KEY_ESC",
46: "KEY_DELETE",
38: "KEY_UP",
40: "KEY_DOWN",
37: "KEY_LEFT",
39: "KEY_RIGHT",
112: "KEY_F1",
113: "KEY_F2",
114: "KEY_F3",
115: "KEY_F4",
116: "KEY_F5",
117: "KEY_F6",
118: "KEY_F7",
119: "KEY_F8",
120: "KEY_F9",
121: "KEY_F10",
122: "KEY_F11",
123: "KEY_F12"
};
	let kcode = event.keyCode || event.charCode;

	// send special events on keydown
	if (typeof kspecial[kcode] !== typeof undefined){
		event.preventDefault();
		if (event.type == "keydown") {
			doSend( kspecial[kcode] );
		}
	}
	// send keys for desktops on keydown since keyup is skipping keys
	else if (event.key.length == 1 && event.type == "keydown") {
                doSend( event.key );
	}
	// send keys for mobiles on keyup since keydown is not writing to the input element at the press time
	else if (event.key.length > 1 && document.myform.inputtext.value.length > 0 && event.type == "keyup"){
		doSend( document.myform.inputtext.value.slice(-1) );
	}

	document.myform.inputtext.value = '';
   }

   function doKey(keyname, mod = ''){
	doSend( keyname );
	document.myform.inputtext.focus();
   }

   function doDisconnect() {
		websocket.close();
   }


</script>

<div id="output"></div>

<form name="myform">
<p>
<textarea name="outputtext" rows="4" cols="50"></textarea>
</p>
<p>
<input name="inputtext" maxlength="1" type="password" autocomplete="off" data-lpignore="true" onKeyUp="sendAndClear()" onKeyDown="sendAndClear()" placeholder="click and type here to send" />
<input type="button" name=enterButton value="Enter" onClick="doKey('KEY_ENTER');" />
</p>
<p>
<input type="button" name=tabButton value="Tab" onClick="doKey('KEY_TAB');" />
<input type="button" name=escButton value="Esc" onClick="doKey('KEY_ESC');" />
<input type="button" name=deleteButton value="Delete" onClick="doKey('KEY_DELETE');" />
<input type="button" name=backspaceButton value="Backspace" onClick="doKey('KEY_BACKSPACE');" />
<input type="button" name=leftButton value="LEFT" onClick="doKey('KEY_LEFT');" style="margin-left: 20px;" />
<input type="button" name=upButton value="UP" onClick="doKey('KEY_UP');" />
<input type="button" name=downButton value="DOWN" onClick="doKey('KEY_DOWN');" />
<input type="button" name=rightButton value="RIGHT" onClick="doKey('KEY_RIGHT');" />
</p>
<input type="button" name=f1Button value="F1" onClick="doKey('KEY_F1');" />
<input type="button" name=f2Button value="F2" onClick="doKey('KEY_F2');" />
<input type="button" name=f3Button value="F3" onClick="doKey('KEY_F3');" />
<input type="button" name=f4Button value="F4" onClick="doKey('KEY_F4');" />
<input type="button" name=f5Button value="F5" onClick="doKey('KEY_F5');" />
<input type="button" name=f6Button value="F6" onClick="doKey('KEY_F6');" />
<input type="button" name=f7Button value="F7" onClick="doKey('KEY_F7');" />
<input type="button" name=f8Button value="F8" onClick="doKey('KEY_F8');" />
<input type="button" name=f9Button value="F9" onClick="doKey('KEY_F9');" />
<input type="button" name=f10Button value="F10" onClick="doKey('KEY_F10');" />
<input type="button" name=f11Button value="F11" onClick="doKey('KEY_F11');" />
<input type="button" name=f12Button value="F12" onClick="doKey('KEY_F12');" />
<p>
</p>
<input type="button" name=alt1Button value="Alt 1" onClick="doKey('KEY_LEFTALT', 'once');" />
<input type="button" name=ctrl1Button value="Ctrl 1" onClick="doKey('KEY_LEFTCTRL', 'once');" />
<input type="button" name=shift1Button value="Shift 1" onClick="doKey('KEY_LEFTSHIFT', 'once');" />
<input type="button" name=altxButton value="Alt x" onClick="doKey('KEY_LEFTALT', 'sticky');" />
<input type="button" name=ctrlxButton value="Ctrl x" onClick="doKey('KEY_LEFTCTRL', 'sticky');" />
<input type="button" name=shiftxButton value="Shift x" onClick="doKey('KEY_LEFTSHIFT', 'sticky');" />
<p>
</p>
<p>
<input name="url" size="70"></textarea>
</p>
<p>
<input type="button" name=disconnectButton value="Disconnect" onClick="doDisconnect();">
<input type="button" name=connectButton value="Connect" onClick="doConnect();">
</p>


</form>
</html> 

